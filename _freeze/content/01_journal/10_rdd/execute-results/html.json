{
  "hash": "f9c28db3808f03e2591fa2b115364fb2",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\n---\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_7e123e8d8f6b386dc9357625a50c911e'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'tidyverse' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'ggplot2' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'tibble' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'tidyr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'readr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'purrr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'dplyr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'stringr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'forcats' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'lubridate' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggthemr)\nlibrary(ggplot2)\ncoupon <- readRDS(\"coupon.rds\")\nc0 <- 60\nbw <- (c0 + c(-5, 5))/2\n\ndf_bw_below <- coupon %>% filter(days_since_last >= bw[1] & days_since_last < c0)\ndf_bw_above <- coupon %>% filter(days_since_last >= c0 & days_since_last <= bw[2])\n\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\ndim(df_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 1562    4\n```\n:::\n\n```{.r .cell-code}\nggthemr()\ndep_var <-\n  ggplot(coupon, aes(x = days_since_last, y = purchase_after, color = coupon)) +\n  geom_vline(xintercept = c0, color = ggthemr::swatch()[5]) +\n  geom_point(alpha = 0.1, size = 0.2) +\n  \n  geom_smooth(data = filter(coupon, days_since_last <= c0), \n              method = \"lm\", se = F, linewidth = 1, linetype = \"dashed\") +\n  geom_smooth(data = filter(coupon, days_since_last > c0), \n              method = \"lm\", se = F, linewidth = 1, linetype = \"dashed\") +\n \n  geom_smooth(data = df_bw_below, method = \"lm\", se = F, \n              color = ggthemr::swatch()[7], linewidth = 2) +\n  geom_smooth(data = df_bw_above, method = \"lm\", se = F, \n              color = ggthemr::swatch()[7], linewidth = 2) +\n  scale_color_discrete(labels = c(\"No coupon\", \"Coupon\")) +\n  xlab(\"Days since last purchase\") +\n  ylab(\"Purchase after coupon assignment\") +\n  theme(legend.title = element_blank())\ndep_var\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n#> `geom_smooth()` using formula = 'y ~ x'\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_ab7bec268b576fd584bc8950bbd43df2'}\n\n```{.r .cell-code}\n\"when we take the half of the bandwidth, we lose the precision. Then, the uncertainty of our estimates may increase.\"\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"when we take the half of the bandwidth, we lose the precision. Then, the uncertainty of our estimates may increase.\"\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-3_fec198b4225933fab2a7e095eb156c0d'}\n\n```{.r .cell-code}\ncoupon <- readRDS(\"coupon.rds\")\nlibrary(ggplot2)\n\nc0 <- 60\nbw <- (c0 + c(-5, 5))*2\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- coupon %>% filter(days_since_last >= bw[1] & days_since_last < c0)\ndf_bw_above <- coupon %>% filter(days_since_last >= c0 & days_since_last <= bw[2])\n\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\ndim(df_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 1047    4\n```\n:::\n\n```{.r .cell-code}\nggthemr()\ndep_var <-\n  ggplot(coupon, aes(x = days_since_last, y = purchase_after, color = coupon)) +\n  geom_vline(xintercept = c0, color = ggthemr::swatch()[5]) +\n  geom_point(alpha = 0.1, size = 0.2) +\n  # add lines for the full range\n  geom_smooth(data = filter(coupon, days_since_last <= c0), \n              method = \"lm\", se = F, linewidth = 1, linetype = \"dashed\") +\n  geom_smooth(data = filter(coupon, days_since_last > c0), \n              method = \"lm\", se = F, linewidth = 1, linetype = \"dashed\") +\n  # add lines for specified bandwidth\n  geom_smooth(data = df_bw_below, method = \"lm\", se = F, \n              color = ggthemr::swatch()[7], linewidth = 2) +\n  geom_smooth(data = df_bw_above, method = \"lm\", se = F, \n              color = ggthemr::swatch()[7], linewidth = 2) +\n  scale_color_discrete(labels = c(\"No coupon\", \"Coupon\")) +\n  xlab(\"Days since last purchase\") +\n  ylab(\"Purchase after coupon assignment\") +\n  theme(legend.title = element_blank())\ndep_var\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n#> `geom_smooth()` using formula = 'y ~ x'\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-4_0ce5139f6a0d1968712e7846c87fd2c2'}\n\n```{.r .cell-code}\n\"when we double the bandwidth we take into account observations that are very different from our cutoff point. Then, it seems like we are introducing confounding factors.\"\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"when we double the bandwidth we take into account observations that are very different from our cutoff point. Then, it seems like we are introducing confounding factors.\"\n```\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-5_a0bbc26e85d4151dd81ab2f119d49ab0'}\n\n```{.r .cell-code}\nlibrary(rddensity)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'rddensity' a été compilé avec la version R 4.3.2\n```\n:::\n\n```{.r .cell-code}\nshipping <- readRDS(\"shipping.rds\")\nc0 <- 30\nrddd <- rddensity(shipping$purchase_amount, c = c0)\nsummary(rddd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       6666\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 30                Left of c           Right of c          \n#> Number of obs         3088                3578                \n#> Eff. Number of obs    2221                1955                \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           22.909              20.394              \n#> \n#> Method                T                   P > |T|             \n#> Robust                5.9855              0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rddd): There are repeated observations. Point\n#> estimates and standard errors have been adjusted. Use option massPoints=FALSE\n#> to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.261                      20      26    0.4614\n#> 0.522                      41      65    0.0250\n#> 0.783                      62     107    0.0007\n#> 1.043                      81     136    0.0002\n#> 1.304                     100     169    0.0000\n#> 1.565                     114     196    0.0000\n#> 1.826                     132     227    0.0000\n#> 2.087                     156     263    0.0000\n#> 2.348                     173     298    0.0000\n#> 2.609                     191     331    0.0000\n```\n:::\n\n```{.r .cell-code}\nrdd_plot <- rdplotdensity(rddd, shipping$purchase_amount, plotN = 100)\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-6_f775efba43194176501cd3d8d7ebc4cb'}\n\n```{.r .cell-code}\n\"The cutoff 30 cant be chosen because as it can be seen in the plot, the confidence intervals dont overlap. Then, we cant use RDD to obtain valid results.\"\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"The cutoff 30 cant be chosen because as it can be seen in the plot, the confidence intervals dont overlap. Then, we cant use RDD to obtain valid results.\"\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}