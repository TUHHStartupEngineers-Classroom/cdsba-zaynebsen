{
  "hash": "fbe34850318e2f9f3f07c19d74e14c9a",
  "result": {
    "markdown": "---\ntitle: \"Difference-in-Differences\"\n---\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-1_891392670f2658b4fd0ce040beee100a'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'tidyverse' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'ggplot2' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'tibble' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'tidyr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'readr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'purrr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'dplyr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'stringr' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'forcats' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning: le package 'lubridate' a été compilé avec la version R 4.3.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nhospdd <- readRDS(\"hospdd.rds\")\ntreated <- hospdd%>% filter(procedure==1&month>3)%>%pull(hospital)\ncontrol <- hospdd%>% filter(procedure==0&month>3)%>%pull(hospital)\nView(treated)\nView(control)\nsatis_treated_before_treatment <- hospdd%>% filter(hospdd$hospital %in% treated==TRUE,month<4)%>% pull(satis)\nmean(satis_treated_before_treatment)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 3.525383\n```\n:::\n\n```{.r .cell-code}\nsatis_treated_after_treatment <- hospdd%>% filter(hospdd$hospital %in% treated==TRUE,month>3)%>% pull(satis)\nmean(satis_treated_after_treatment)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 4.363351\n```\n:::\n\n```{.r .cell-code}\nsatis_control_before_treatment <- hospdd%>% filter(hospdd$hospital %in% control==TRUE,month<4)%>% pull(satis)\nmean(satis_control_before_treatment)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 3.392509\n```\n:::\n\n```{.r .cell-code}\nsatis_control_after_treatment <- hospdd%>% filter(hospdd$hospital %in% control==TRUE,month>3)%>% pull(satis)\nmean(satis_control_after_treatment)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 3.38249\n```\n:::\n:::\n\n::: {.cell hash='08_did_cache/html/unnamed-chunk-2_90567a31dd14327df5c1389b58d12c6d'}\n\n```{.r .cell-code}\n# Step 1: Difference between treatment and control group BEFORE treatment\n satis_treated_before_treatment <- hospdd%>% filter(hospdd$hospital %in% treated==TRUE,month<4)%>% pull(satis)\n\nsatis_treated_after_treatment <- hospdd%>% filter(hospdd$hospital %in% treated==TRUE,month>3)%>% pull(satis)\n\nsatis_control_before_treatment <- hospdd%>% filter(hospdd$hospital %in% control==TRUE,month<4)%>% pull(satis)\n\nsatis_control_after_treatment <- hospdd%>% filter(hospdd$hospital %in% control==TRUE,month>3)%>% pull(satis)\n\n# Difference between treatment and control group BEFORE treatment\ndiff_before_treat <- c(satis_treated_before_treatment,replicate(620,0)) - satis_control_before_treatment\n\n# Difference between treatment and control group AFTER treatment\ndiff_after_treat <- c(satis_treated_after_treatment,replicate(620,0)) - satis_control_after_treatment\n\n\nafter <- as.numeric(ifelse(hospdd$month > 4, 1, 0))\n\nsummary(lm(satis ~ (month*after+month+hospital) , data = hospdd))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ (month * after + month + hospital), data = hospdd)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.3090 -0.6691 -0.0823  0.5790  5.7455 \n#> \n#> Coefficients:\n#>               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  3.7091739  0.0376799  98.439  < 2e-16 ***\n#> month        0.0953431  0.0128433   7.424 1.27e-13 ***\n#> after        0.4872791  0.1469238   3.317 0.000916 ***\n#> hospital    -0.0175982  0.0008725 -20.169  < 2e-16 ***\n#> month:after -0.0962388  0.0269404  -3.572 0.000356 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 1.016 on 7363 degrees of freedom\n#> Multiple R-squared:  0.07369,\tAdjusted R-squared:  0.07318 \n#> F-statistic: 146.4 on 4 and 7363 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\nsummary(lm(satis ~ month*after+as.factor(hospdd$month) + as.factor(hospdd$hospital) , data = hospdd ))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satis ~ month * after + as.factor(hospdd$month) + \n#>     as.factor(hospdd$hospital), data = hospdd)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -3.4357 -0.4930 -0.0120  0.4755  4.5398 \n#> \n#> Coefficients: (3 not defined because of singularities)\n#>                               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)                   3.426688   0.067458  50.798  < 2e-16 ***\n#> month                        -0.007357   0.035116  -0.209 0.834068    \n#> after                         0.385583   0.194728   1.980 0.047728 *  \n#> as.factor(hospdd$month)2     -0.002251   0.046454  -0.048 0.961353    \n#> as.factor(hospdd$month)3      0.036682   0.076533   0.479 0.631746    \n#> as.factor(hospdd$month)4      0.371424   0.109650   3.387 0.000709 ***\n#> as.factor(hospdd$month)5     -0.012922   0.060823  -0.212 0.831761    \n#> as.factor(hospdd$month)6            NA         NA      NA       NA    \n#> as.factor(hospdd$month)7            NA         NA      NA       NA    \n#> as.factor(hospdd$hospital)2   0.408566   0.080413   5.081 3.85e-07 ***\n#> as.factor(hospdd$hospital)3   0.533625   0.082596   6.461 1.11e-10 ***\n#> as.factor(hospdd$hospital)4   0.227510   0.076977   2.956 0.003131 ** \n#> as.factor(hospdd$hospital)5  -0.145353   0.076977  -1.888 0.059030 .  \n#> as.factor(hospdd$hospital)6   0.447863   0.076977   5.818 6.20e-09 ***\n#> as.factor(hospdd$hospital)7   1.404416   0.074390  18.879  < 2e-16 ***\n#> as.factor(hospdd$hospital)8   0.071876   0.079452   0.905 0.365685    \n#> as.factor(hospdd$hospital)9  -1.518515   0.081457 -18.642  < 2e-16 ***\n#> as.factor(hospdd$hospital)10  1.682845   0.080413  20.927  < 2e-16 ***\n#> as.factor(hospdd$hospital)11  0.220965   0.079452   2.781 0.005431 ** \n#> as.factor(hospdd$hospital)12 -0.095303   0.081457  -1.170 0.242047    \n#> as.factor(hospdd$hospital)13  0.495593   0.078564   6.308 2.99e-10 ***\n#> as.factor(hospdd$hospital)14  0.233043   0.082596   2.821 0.004793 ** \n#> as.factor(hospdd$hospital)15 -0.144494   0.082596  -1.749 0.080263 .  \n#> as.factor(hospdd$hospital)16  1.414268   0.080413  17.588  < 2e-16 ***\n#> as.factor(hospdd$hospital)17  0.423543   0.083843   5.052 4.49e-07 ***\n#> as.factor(hospdd$hospital)18  0.153276   0.097668   1.569 0.116609    \n#> as.factor(hospdd$hospital)19 -1.169296   0.082596 -14.157  < 2e-16 ***\n#> as.factor(hospdd$hospital)20 -0.376607   0.080413  -4.683 2.87e-06 ***\n#> as.factor(hospdd$hospital)21  0.770343   0.085215   9.040  < 2e-16 ***\n#> as.factor(hospdd$hospital)22  0.375321   0.083843   4.476 7.70e-06 ***\n#> as.factor(hospdd$hospital)23  0.277726   0.082596   3.362 0.000776 ***\n#> as.factor(hospdd$hospital)24 -0.732120   0.088421  -8.280  < 2e-16 ***\n#> as.factor(hospdd$hospital)25  0.222480   0.094875   2.345 0.019055 *  \n#> as.factor(hospdd$hospital)26 -0.209747   0.080413  -2.608 0.009116 ** \n#> as.factor(hospdd$hospital)27 -0.822648   0.077742 -10.582  < 2e-16 ***\n#> as.factor(hospdd$hospital)28  0.288001   0.085215   3.380 0.000729 ***\n#> as.factor(hospdd$hospital)29 -0.175443   0.081457  -2.154 0.031288 *  \n#> as.factor(hospdd$hospital)30 -0.591916   0.097668  -6.060 1.42e-09 ***\n#> as.factor(hospdd$hospital)31  0.088091   0.080413   1.095 0.273344    \n#> as.factor(hospdd$hospital)32 -0.747340   0.081457  -9.175  < 2e-16 ***\n#> as.factor(hospdd$hospital)33 -0.877969   0.080413 -10.918  < 2e-16 ***\n#> as.factor(hospdd$hospital)34 -0.424406   0.075599  -5.614 2.05e-08 ***\n#> as.factor(hospdd$hospital)35 -0.069883   0.077742  -0.899 0.368729    \n#> as.factor(hospdd$hospital)36  1.714149   0.078564  21.818  < 2e-16 ***\n#> as.factor(hospdd$hospital)37 -0.283590   0.094875  -2.989 0.002807 ** \n#> as.factor(hospdd$hospital)38 -0.510800   0.079452  -6.429 1.36e-10 ***\n#> as.factor(hospdd$hospital)39 -0.447491   0.083843  -5.337 9.72e-08 ***\n#> as.factor(hospdd$hospital)40  0.697539   0.079452   8.779  < 2e-16 ***\n#> as.factor(hospdd$hospital)41 -0.573729   0.077742  -7.380 1.76e-13 ***\n#> as.factor(hospdd$hospital)42  0.457143   0.086733   5.271 1.40e-07 ***\n#> as.factor(hospdd$hospital)43 -1.196426   0.082596 -14.485  < 2e-16 ***\n#> as.factor(hospdd$hospital)44 -0.389582   0.092446  -4.214 2.54e-05 ***\n#> as.factor(hospdd$hospital)45 -0.637743   0.077742  -8.203 2.74e-16 ***\n#> as.factor(hospdd$hospital)46 -0.345502   0.083843  -4.121 3.82e-05 ***\n#> month:after                         NA         NA      NA       NA    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.7536 on 7316 degrees of freedom\n#> Multiple R-squared:  0.4941,\tAdjusted R-squared:  0.4905 \n#> F-statistic: 140.1 on 51 and 7316 DF,  p-value: < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n\"The  difference between the two methods is that when you consider the variables month and hospital as a factor, it forms a vector of values from these variables.\"\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] \"The  difference between the two methods is that when you consider the variables month and hospital as a factor, it forms a vector of values from these variables.\"\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}